# Story 1.6: Assessment History System

## Status
Planned

## Story
**As a** médico usuário autenticado,  
**I want** acessar o histórico completo de minhas avaliações anteriores,  
**so that** posso acompanhar minha evolução e revisar resultados passados.

## Acceptance Criteria
1. Tela/seção para listar todas as avaliações do usuário
2. Informações exibidas: data, tipo, status, tempo de conclusão
3. Filtros por tipo de avaliação (complete, disc, soft_skills, sjt) e por data
4. Visualização completa de resultados de avaliações concluídas
5. Paginação para usuários com muitas avaliações
6. Design consistente com sistema existente
7. Loading states durante carregamento do histórico
8. Export functionality para resultados (PDF/CSV)

## Priority
MEDIUM - User retention feature

## Dependencies
- Story 1.3: Assessment Persistence System (API infrastructure)
- Story 1.1-1.2: Authentication e Profile Management

## Tasks / Subtasks
- [ ] Criar componente AssessmentHistory principal (AC: 1, 2, 6, 7)
  - [ ] Implementar layout responsivo para desktop e mobile
  - [ ] Criar card/list view para exibir avaliações
  - [ ] Integrar design system existente (Radix UI + Tailwind)
  - [ ] Implementar loading skeleton durante fetch
  - [ ] Adicionar empty state para usuários sem histórico
  - [ ] Implementar infinite scroll ou traditional pagination
- [ ] Implementar sistema de filtros (AC: 3)
  - [ ] Filter by assessment type (complete, disc, soft_skills, sjt)
  - [ ] Filter by date range (último mês, 3 meses, 6 meses, custom)
  - [ ] Filter by status (completed, in_progress)
  - [ ] Implementar reset filters functionality
  - [ ] Persist filter state in URL params para sharing
  - [ ] Adicionar quick filter buttons (hoje, semana, mês)
- [ ] Criar componente AssessmentDetailView (AC: 4)
  - [ ] Modal ou full-page view para resultados detalhados
  - [ ] Renderizar DISC results com gráficos apropriados
  - [ ] Exibir soft skills results com scores e insights
  - [ ] Mostrar SJT results com breakdown de competências
  - [ ] Incluir timestamps de início e conclusão
  - [ ] Adicionar comparison com outras avaliações (opcional)
- [ ] Implementar paginação e performance (AC: 5)
  - [ ] Server-side pagination na API existente (/api/assessments)
  - [ ] Client-side pagination controls
  - [ ] Lazy loading de assessment details
  - [ ] Virtualization para large lists (se necessário)
  - [ ] Cache assessment data para improve UX
- [ ] Sistema de export (AC: 8)
  - [ ] Export individual assessment para PDF
  - [ ] Export multiple assessments para CSV
  - [ ] Include assessment metadata e timestamps
  - [ ] Implement download progress indicators
  - [ ] Add export history tracking (opcional)
- [ ] Integração com navegação existente
  - [ ] Adicionar "History" link no menu/navigation
  - [ ] Integrar com AuthenticationProvider para user context
  - [ ] Add breadcrumbs para navigation clarity
  - [ ] Implement deep linking para specific assessments

## Dev Notes

### Previous Story Context
Story 1.3 implementou a infraestrutura API básica (GET /api/assessments, GET /api/assessment/:id) mas não criou interface de usuário. Esta story foca na UX de histórico e visualização de resultados.

### Technical Foundation Available
- ✅ API endpoints: GET /api/assessments (list), GET /api/assessment/:id (detail)
- ✅ Database schema: assessments table com metadata completo
- ✅ Authentication context via AuthenticationProvider
- ✅ Design system estabelecido (Stories 1.1-1.2)

### Component Architecture

**AssessmentHistory (Main Component):**
- Location: `components/assessment/assessment-history.tsx`
- Responsibility: Main container para history interface
- Integration: Uses existing API endpoints, AuthProvider

**AssessmentList:**
- Location: `components/assessment/assessment-list.tsx`
- Responsibility: Render lista de assessments com filtering/pagination
- Props: `assessments`, `filters`, `onFilterChange`, `onSelectAssessment`

**AssessmentDetailView:**
- Location: `components/assessment/assessment-detail-view.tsx`
- Responsibility: Detailed view de assessment específico
- Props: `assessmentId`, `isOpen`, `onClose`

**AssessmentFilters:**
- Location: `components/assessment/assessment-filters.tsx`
- Responsibility: Filter controls e state management
- Props: `filters`, `onFilterChange`, `onReset`

### Data Flow Architecture

```typescript
// Assessment History Data Flow:
1. AssessmentHistory → useAssessmentHistory hook
2. useAssessmentHistory → GET /api/assessments (com filters)
3. AssessmentList → render assessments com pagination
4. AssessmentDetailView → GET /api/assessment/:id para details
5. Export functionality → generate PDF/CSV client-side
```

### API Enhancements Needed

**Extend GET /api/assessments:**
```typescript
// Current response from Story 1.3
interface AssessmentListResponse {
  assessments: Assessment[];
  pagination: { total: number, page: number, limit: number };
}

// Enhancement needed:
interface EnhancedAssessmentListResponse {
  assessments: Assessment[];
  pagination: { total: number, page: number, limit: number };
  summary: {
    totalCompleted: number;
    totalInProgress: number;
    averageCompletionTime: number;
    lastAssessmentDate: string;
  };
}
```

### UI/UX Design Patterns

**List View Layout:**
```
┌─────────────────────────────────────────────────────┐
│ [Filters Bar] [Search] [Export] [View Toggle]       │
├─────────────────────────────────────────────────────┤
│ ┌─────┐ Assessment Type | Date | Status | Duration  │
│ │Icon │ Complete DISC  | 2d ago | ✓ | 45min        │
│ └─────┘ [View Details] [Export PDF]                 │
├─────────────────────────────────────────────────────┤
│ ┌─────┐ Soft Skills Only | 1w ago | ✓ | 30min      │
│ │Icon │ [View Details] [Export PDF]                 │
│ └─────┘                                             │
└─────────────────────────────────────────────────────┘
```

**Detail View Modal:**
```
┌─────────────────────────────────────────────────────┐
│ Assessment Details - Complete DISC (Jan 27, 2025)   │ [X]
├─────────────────────────────────────────────────────┤
│ [DISC Chart] | [Soft Skills Scores] | [SJT Results] │
│              |                      |               │
│ D: 25, I: 15 | Comunicação: 85%    | Scenario 1: A │
│ S: 20, C: 10 | Liderança: 70%      | Scenario 2: C │
├─────────────────────────────────────────────────────┤
│ Started: 10:00 AM | Completed: 10:45 AM | [Export] │
└─────────────────────────────────────────────────────┘
```

### Integration Points

**Navigation Integration:**
- Add "History" link to main navigation
- Breadcrumb: Home > Assessment > History
- Deep linking: `/assessment/history` e `/assessment/history/:id`

**State Management:**
- Use existing AuthenticationProvider para user context
- Local state para filters e pagination
- URL state para deep linking e sharing

### Performance Considerations

**Data Loading:**
- Paginated loading (20 assessments per page)
- Lazy loading de assessment details
- Cache frequently accessed assessments
- Prefetch next page durante scroll

**Rendering:**
- Virtual scrolling para very large histories
- Skeleton loading states
- Optimistic updates para better UX

### File Locations

**New files to create:**
- `components/assessment/assessment-history.tsx` - Main history component
- `components/assessment/assessment-list.tsx` - List rendering
- `components/assessment/assessment-detail-view.tsx` - Detail modal
- `components/assessment/assessment-filters.tsx` - Filter controls
- `components/assessment/assessment-export.tsx` - Export functionality
- `hooks/use-assessment-history.ts` - History data hook

**Files to enhance:**
- `app/api/assessments/route.ts` - Add filtering, summary data
- Navigation component - Add history link

### Export Functionality

**PDF Export:**
- Use react-pdf ou jsPDF para generation
- Include assessment charts e visual results
- Professional formatting com logo/branding

**CSV Export:**
- Tabular data com all assessment metadata
- Multiple assessments in single file
- Include calculated scores e timestamps

## Testing

### Testing Strategy
**Framework:** Jest + React Testing Library  
**Coverage Target:** 80% para history components  
**Location:** Co-localizado com components

**Required Tests:**
- Component tests para AssessmentHistory, AssessmentList, filters
- Integration tests para API calls e data flow
- User interaction tests para filtering, pagination, export
- Performance tests para large datasets
- Accessibility tests para screen readers

**Mock Strategy:**
- Mock assessment data com realistic datasets
- Mock API calls para different scenarios (empty, error, large dataset)
- Mock export functions para testing download flows

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-27 | 1.0 | Story creation based on Correct Course Analysis - assessment history system | Bob (Scrum Master) | 